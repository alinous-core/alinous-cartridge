#!/bin/bash

set -e

source $OPENSHIFT_CARTRIDGE_SDK_BASH
source ${OPENSHIFT_ALINOUS_DIR}/bin/util

export TOMCAT_DIR=${OPENSHIFT_ALINOUS_DIR}tomcat
export ALINOUS_HOME=${OPENSHIFT_ALINOUS_DIR}ALINOUS_HOME

SRC_PATH=${OPENSHIFT_ALINOUS_DIR}versions/${TOMCAT_BINARY}

client_message "Start Installing Alinous-Core Cartridge $ALINOUS_HOME"
client_message "Copy $SRC_PATH to $TOMCAT_DIR"

if [ ! -d $TOMCAT_DIR ]; then
	mkdir -p $TOMCAT_DIR
	mkdir -p $TOMCAT_DIR/logs
	mkdir -p $TOMCAT_DIR/temp
	mkdir -p $TOMCAT_DIR/webapps
	mkdir -p $TOMCAT_DIR/work
fi

cp -Rf ${SRC_PATH}/* ${TOMCAT_DIR}

sed_replace_env=$(print_sed_exp_replace_env_var)

client_message "sed_replace_env : $sed_replace_env"

replacement_conf_files=(
  "server.xml"
  "context.xml"
)

for conf_file in "${replacement_conf_files[@]}"; do
  sed ${sed_replace_env} ${SRC_PATH}/config/${conf_file} > ${TOMCAT_DIR}/conf/${conf_file}
done





