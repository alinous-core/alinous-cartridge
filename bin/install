#!/bin/bash

set -e

source $OPENSHIFT_CARTRIDGE_SDK_BASH

export TOMCAT_DIR=${OPENSHIFT_ALINOUS_DIR}tomcat
export ALINOUS_HOME=${OPENSHIFT_ALINOUS_DIR}ALINOUS_HOME

SRC_PATH=${OPENSHIFT_ALINOUS_DIR}versions/${TOMCAT_BINARY}

client_message "Start Installing Alinous-Core Cartridge $ALINOUS_HOME"
client_message "Copy $SRC_PATH to $TOMCAT_DIR"

if [ ! -d $TOMCAT_DIR ]; then
	mkdir -p $TOMCAT_DIR
	mkdir -p $TOMCAT_DIR/logs
	mkdir -p $TOMCAT_DIR/temp
	mkdir -p $TOMCAT_DIR/webapps
	mkdir -p $TOMCAT_DIR/work
fi

cp -Rf ${SRC_PATH}/* ${TOMCAT_DIR}

# Link the system Tomcat binaries to the cart Tomcat instance directory
SYSTEM_TOMCAT_DIR="/opt/apache-tomcat-7.0"

ln -sf ${SYSTEM_TOMCAT_DIR}/bin/bootstrap.jar ${TOMCAT_DIR}/bin/bootstrap.jar
ln -sf ${SYSTEM_TOMCAT_DIR}/bin/commons-daemon.jar ${TOMCAT_DIR}/bin/commons-daemon.jar
ln -sf ${SYSTEM_TOMCAT_DIR}/bin/tomcat-juli.jar ${TOMCAT_DIR}/bin/tomcat-juli.jar





